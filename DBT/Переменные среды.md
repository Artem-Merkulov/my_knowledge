# Переменные среды

В dbt можно задавать переменные среды (environment variables) несколькими способами. 
Это позволяет управлять конфигурациями и параметрами без необходимости изменения самого 
кода. Вот несколько основных методов:

### 1. Использование файла `.env`

Вы можете создать файл `.env` в корневом каталоге вашего проекта dbt. В этом файле вы 
можете задавать переменные среды в формате `KEY=VALUE`. Например:

```
DBT_ENV_VAR_API_KEY=your_api_key
DBT_ENV_VAR_DATABASE_URL=your_database_url
```

Затем вы можете использовать эти переменные в вашем проекте dbt, обращаясь к ним через Jinja:

```jinja
{{ env_var('DBT_ENV_VAR_API_KEY') }}
```

### 2. Использование командной строки

Вы также можете задавать переменные среды непосредственно в командной строке перед 
запуском команды dbt. Например, на Unix-системах вы можете сделать это следующим образом:

```bash
export DBT_ENV_VAR_API_KEY=your_api_key
dbt run
```

На Windows это можно сделать так:

```cmd
set DBT_ENV_VAR_API_KEY=your_api_key
dbt run
```

### 3. Использование профиля `profiles.yml`

Если вы хотите хранить конфиденциальные данные, такие как пароли или ключи API, вы можете 
использовать файл `profiles.yml`. В этом файле можно задавать переменные, которые будут 
использоваться для подключения к базе данных. Например:

```yaml
my_profile:
  target: dev
  outputs:
    dev:
      type: postgres
      host: {{ env_var('DBT_ENV_VAR_HOST') }}
      user: {{ env_var('DBT_ENV_VAR_USER') }}
      password: {{ env_var('DBT_ENV_VAR_PASSWORD') }}
      dbname: my_database
      port: 5432
```

### 4. Использование переменных в `dbt_project.yml`

Вы также можете задавать переменные в файле `dbt_project.yml`, используя секцию `vars`. Например:

```yaml
vars:
  my_variable: your_value
```

Вы можете затем получить доступ к этой переменной в вашем SQL-коде или моделях:

```jinja
{{ var('my_variable') }}
```

### Итог

Эти методы позволяют гибко управлять конфигурацией проекта dbt и обеспечивать безопасность 
конфиденциальных данных. Выбор подхода может зависеть от особенностей окружения и требований 
к безопасности.


Затем, ДО того как вы выполните команду `dbt_run`, нужно установить переменные окружения `DBT_USER` и `DBT_PASSWORD` для системы, пользователя или сеанса оболочки. Это зависит от ОС, но есть много хороших инструкций по этому вопросу. Чтобы установить переменную для сессии оболочки (для Unix OS), это может выглядеть следующим образом:
```
$ export DBT_USER=my_username
$ export DBT_PASSWORD=abc123
$ dbt run
```
Обратите внимание, что хранение паролей в переменных окружения не обязательно более безопасно, чем хранение их в файле `profiles.yml`, поскольку они хранятся в открытом виде и не защищены от попадания в журналы и т. д. (не стоит проверять `profiles.yml` в системе контроля исходного кода). Вам следует рассмотреть возможность использования имени переменной окружения с префиксом `DBT_ENV_SECRET_`, чтобы dbt не выбрасывал их в журналы. См. документацию для получения дополнительной информации.